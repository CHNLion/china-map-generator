# ä¸­æ–‡å­—ä½“é—®é¢˜è§£å†³æŒ‡å—

## âœ… é—®é¢˜å·²è§£å†³

**ä» v2.2.1 ç‰ˆæœ¬å¼€å§‹ï¼Œé¡¹ç›®å·²å†…ç½®æ€æºé»‘ä½“å­—ä½“æ–‡ä»¶ï¼Œæ— éœ€é¢å¤–é…ç½®å³å¯æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡ï¼**

## é—®é¢˜æè¿°

åœ¨Renderæˆ–å…¶ä»–LinuxæœåŠ¡å™¨ä¸Šéƒ¨ç½²åï¼Œç”Ÿæˆçš„åœ°å›¾ä¸­æ‰€æœ‰ä¸­æ–‡éƒ½æ˜¾ç¤ºä¸ºæ–¹æ¡†ï¼ˆâ–¡â–¡â–¡ï¼‰ã€‚

**åŸå› **ï¼šLinuxæœåŠ¡å™¨é»˜è®¤æ²¡æœ‰å®‰è£…ä¸­æ–‡å­—ä½“ï¼Œä¸”matplotlibæ— æ³•æ‰¾åˆ°å¯ç”¨çš„ä¸­æ–‡å­—ä½“ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šé¡¹ç›®å·²å†…ç½® `app/static/fonts/SourceHanSansSC-Regular.otf`ï¼ˆæ€æºé»‘ä½“ï¼‰ï¼Œä»£ç ä¼šè‡ªåŠ¨ä¼˜å…ˆä½¿ç”¨è¯¥å­—ä½“æ–‡ä»¶ã€‚

---

## ğŸ”§ æŠ€æœ¯å®ç°ï¼ˆv2.2.1+ï¼‰

é¡¹ç›®é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®ä¿ä¸­æ–‡æ­£å¸¸æ˜¾ç¤ºï¼š

1. **å†…ç½®å­—ä½“æ–‡ä»¶**ï¼š
   - è·¯å¾„ï¼š`app/static/fonts/SourceHanSansSC-Regular.otf`
   - å­—ä½“ï¼šAdobe æ€æºé»‘ä½“ SC Regularï¼ˆ15.8MBï¼‰
   - éšé¡¹ç›®ä»£ç ä¸€èµ·éƒ¨ç½²ï¼Œæ— éœ€ç³»ç»Ÿå®‰è£…

2. **æ™ºèƒ½å­—ä½“åŠ è½½**ï¼š
   ```python
   # ä¼˜å…ˆçº§ï¼šé¡¹ç›®å­—ä½“ > Linuxç³»ç»Ÿå­—ä½“ > Windowså­—ä½“
   font_prop = fm.FontProperties(fname=font_file_path)
   fm.fontManager.addfont(font_file_path)  # æ³¨å†Œåˆ°å­—ä½“ç®¡ç†å™¨
   ```

3. **æ˜¾å¼å­—ä½“åº”ç”¨**ï¼š
   - æ‰€æœ‰æ–‡æœ¬å…ƒç´ ï¼ˆæ ‡ç­¾ã€æ ‡é¢˜ã€æ¯”ä¾‹å°ºç­‰ï¼‰éƒ½é€šè¿‡ `fontproperties` å‚æ•°æ˜¾å¼æŒ‡å®šå­—ä½“
   - ä½¿ç”¨åŒ…è£…å‡½æ•° `add_text_with_font()` ç»Ÿä¸€å¤„ç†
   - ä¸ä¾èµ–matplotlibçš„å…¨å±€å­—ä½“é…ç½®ï¼Œç¡®ä¿ç¨³å®šæ€§

---

## ğŸ› ï¸ å¤‡ç”¨æ–¹æ¡ˆï¼ˆä»…åœ¨å‡ºç°é—®é¢˜æ—¶ä½¿ç”¨ï¼‰

> **æ³¨æ„**ï¼šä» v2.2.1 ç‰ˆæœ¬å¼€å§‹ï¼Œå­—ä½“æ–‡ä»¶å·²å†…ç½®ï¼Œé€šå¸¸æ— éœ€ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆã€‚
> ä»¥ä¸‹æ–¹æ¡ˆä»…åœ¨é‡åˆ°ç‰¹æ®Šæƒ…å†µæ—¶å‚è€ƒã€‚

### æ–¹æ¡ˆ1ï¼šä¿®æ”¹Renderæ„å»ºå‘½ä»¤ï¼ˆä¸æ¨èï¼‰

1. ç™»å½• [Render Dashboard](https://dashboard.render.com/)
2. é€‰æ‹©ä½ çš„æœåŠ¡ï¼ˆchina-map-generatorï¼‰
3. è¿›å…¥ **Settings** é¡µé¢
4. æ‰¾åˆ° **Build Command**
5. ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š

```bash
pip install -r requirements.txt && apt-get update && apt-get install -y fonts-noto-cjk fonts-wqy-microhei && fc-cache -fv
```

6. ç‚¹å‡» **Save Changes**
7. æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²ï¼ˆDeploy â†’ Manual Deploy â†’ Deploy latest commitï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… æœ€ç®€å•ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
- âœ… å­—ä½“å®‰è£…åˆ°ç³»ç»Ÿï¼Œæ€§èƒ½å¥½
- âœ… ä¸€æ¬¡é…ç½®ï¼Œæ°¸ä¹…ç”Ÿæ•ˆ

---

### æ–¹æ¡ˆ2ï¼šé‡æ–°ä¸‹è½½å­—ä½“æ–‡ä»¶

å¦‚æœå­—ä½“æ–‡ä»¶æŸåæˆ–ç¼ºå¤±ï¼Œå¯ä»¥é‡æ–°ä¸‹è½½ï¼š

```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•
cd app/static/fonts

# ä¸‹è½½æ€æºé»‘ä½“ï¼ˆ15.8MBï¼‰
# ä½¿ç”¨è…¾è®¯äº‘é•œåƒï¼ˆå›½å†…é€Ÿåº¦å¿«ï¼‰
wget https://mirrors.cloud.tencent.com/noto-cjk/NotoSansCJKsc-Regular.otf -O SourceHanSansSC-Regular.otf

# æˆ–ä»Adobe GitHubä»“åº“ä¸‹è½½
wget https://github.com/adobe-fonts/source-han-sans/raw/release/OTF/SimplifiedChinese/SourceHanSansSC-Regular.otf
```

æäº¤åˆ°Gitï¼š
```bash
git add app/static/fonts/SourceHanSansSC-Regular.otf
git commit -m "Update Chinese font file"
git push origin main
```

---

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼ˆè‡ªå»ºæœåŠ¡å™¨ï¼‰

å¦‚æœä½ æœ‰SSHè®¿é—®æƒé™ï¼Œå¯ä»¥ç›´æ¥å®‰è£…ç³»ç»Ÿå­—ä½“ï¼š

```bash
# Debian/Ubuntu
sudo apt-get update
sudo apt-get install -y fonts-noto-cjk fonts-wqy-microhei
sudo fc-cache -fv

# CentOS/RHEL  
sudo yum install -y wqy-microhei-fonts
sudo fc-cache -fv
```

---

## ğŸ“‹ éªŒè¯å­—ä½“æ˜¯å¦ç”Ÿæ•ˆ

### æ–¹æ³•1ï¼šæŸ¥çœ‹åº”ç”¨æ—¥å¿—

åœ¨Render Dashboardä¸­ï¼š
1. è¿›å…¥ä½ çš„æœåŠ¡
2. ç‚¹å‡» **Logs** æ ‡ç­¾
3. æŸ¥æ‰¾ä»¥ä¸‹ä¿¡æ¯ï¼š

**æˆåŠŸçš„æ—¥å¿—**ï¼š
```
âœ“ æˆåŠŸåŠ è½½ä¸­æ–‡å­—ä½“: /usr/share/fonts/...
  å­—ä½“åç§°: Noto Sans CJK SC
```

**å¤±è´¥çš„æ—¥å¿—**ï¼š
```
âš  æœªæ‰¾åˆ°å­—ä½“æ–‡ä»¶ï¼Œä½¿ç”¨å­—ä½“æ—åç§°åå¤‡æ–¹æ¡ˆ
```

### æ–¹æ³•2ï¼šç”Ÿæˆæµ‹è¯•åœ°å›¾

1. è®¿é—®ä½ çš„åº”ç”¨URL
2. ç”Ÿæˆä¸€å¼ åŒ…å«ä¸­æ–‡çš„åœ°å›¾
3. æ£€æŸ¥ä¸­æ–‡æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

---

## ğŸ”§ æ¨èå­—ä½“

ä»¥ä¸‹æ˜¯ç»è¿‡æµ‹è¯•çš„å¼€æºä¸­æ–‡å­—ä½“ï¼š

| å­—ä½“åç§° | æ–‡ä»¶å¤§å° | ç‰¹ç‚¹ | æ¨èåº¦ |
|---------|---------|------|--------|
| **æ€æºé»‘ä½“** (Noto Sans SC) | 6-8MB | æ¸…æ™°ç¾è§‚ï¼ŒGoogleå®˜æ–¹ | â­â­â­â­â­ |
| **æ–‡æ³‰é©¿å¾®ç±³é»‘** | 2-3MB | è½»é‡ï¼Œé€‚åˆæœåŠ¡å™¨ | â­â­â­â­ |
| **æ–‡æ³‰é©¿æ­£é»‘** | 8-10MB | é£æ ¼æŸ”å’Œ | â­â­â­ |

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ä¿®æ”¹äº†æ„å»ºå‘½ä»¤ï¼Œä½†å­—ä½“è¿˜æ˜¯æ–¹æ¡†ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿æ„å»ºå‘½ä»¤æ­£ç¡®å¤åˆ¶ï¼ˆæ²¡æœ‰æ¢è¡Œï¼‰
2. æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
3. æŸ¥çœ‹æ„å»ºæ—¥å¿—ï¼Œç¡®è®¤å­—ä½“å®‰è£…æˆåŠŸ
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•

### Q2: Renderæ„å»ºæ—¶æç¤ºæƒé™é”™è¯¯ï¼Ÿ

**åŸå› **ï¼šRenderçš„å…è´¹è®¡åˆ’æœ‰ä¸€äº›é™åˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ–¹æ¡ˆ2ï¼ˆæäº¤å­—ä½“æ–‡ä»¶ï¼‰
- æˆ–å‡çº§åˆ°Renderä»˜è´¹è®¡åˆ’

### Q3: å­—ä½“æ–‡ä»¶å¤ªå¤§ï¼ŒGitæäº¤å¤±è´¥ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨Git LFSï¼ˆLarge File Storageï¼‰
- æˆ–ä½¿ç”¨æ–¹æ¡ˆ1ï¼ˆç³»ç»Ÿå®‰è£…å­—ä½“ï¼‰

### Q4: Railwayéƒ¨ç½²å¦‚ä½•è§£å†³ï¼Ÿ

Railwayä½¿ç”¨Dockeræ„å»ºï¼ŒDockerfileå·²åŒ…å«å­—ä½“å®‰è£…ï¼š

```dockerfile
RUN apt-get update && apt-get install -y \
    fonts-noto-cjk \
    fonts-wqy-microhei \
    fontconfig \
    && fc-cache -fv
```

ç›´æ¥éƒ¨ç½²å³å¯ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

---

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

### å­—ä½“æœç´¢ä¼˜å…ˆçº§

é¡¹ç›®ä»£ç ä¼šæŒ‰ä»¥ä¸‹é¡ºåºæœç´¢å­—ä½“ï¼š

1. **é¡¹ç›®å­—ä½“ç›®å½•**ï¼š`app/static/fonts/`
   - NotoSansSC-Regular.otf
   - NotoSansCJKsc-Regular.otf
   - wqy-microhei.ttc

2. **Linuxç³»ç»Ÿå­—ä½“**ï¼š
   - /usr/share/fonts/opentype/noto/
   - /usr/share/fonts/truetype/wqy/

3. **Windowsç³»ç»Ÿå­—ä½“**ï¼š
   - C:/Windows/Fonts/msyh.ttcï¼ˆå¾®è½¯é›…é»‘ï¼‰
   - C:/Windows/Fonts/simhei.ttfï¼ˆé»‘ä½“ï¼‰

4. **macOSç³»ç»Ÿå­—ä½“**ï¼š
   - /System/Library/Fonts/PingFang.ttc

5. **å­—ä½“æ—åç§°åå¤‡**ï¼š
   - Noto Sans CJK SC
   - WenQuanYi Micro Hei
   - Microsoft YaHei

### ä¸ºä»€ä¹ˆéœ€è¦å­—ä½“ï¼Ÿ

matplotlibåœ¨æ¸²æŸ“ä¸­æ–‡æ—¶éœ€è¦ä¸­æ–‡å­—ä½“æ–‡ä»¶ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼š
- ä¼šæ˜¾ç¤ºæ–¹æ¡†ï¼ˆtofuï¼‰
- æˆ–æ˜¾ç¤ºé—®å·
- æˆ–å®Œå…¨ä¸æ˜¾ç¤º

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**ï¼šå¤åˆ¶Renderçš„å®Œæ•´æ„å»ºå’Œè¿è¡Œæ—¥å¿—
2. **æäº¤Issue**ï¼šè®¿é—® [GitHub Issues](https://github.com/CHNLion/china-map-generator/issues)
3. **åŒ…å«ä¿¡æ¯**ï¼š
   - éƒ¨ç½²å¹³å°ï¼ˆRender/Railway/å…¶ä»–ï¼‰
   - é”™è¯¯æ—¥å¿—
   - ä½¿ç”¨çš„æ–¹æ¡ˆ

---

## âœ… æ¨èé…ç½®æ€»ç»“

**Renderéƒ¨ç½²ï¼ˆæ¨èï¼‰**ï¼š
- Build Command: `pip install -r requirements.txt && apt-get update && apt-get install -y fonts-noto-cjk fonts-wqy-microhei && fc-cache -fv`
- Start Command: `python app.py`

**Railwayéƒ¨ç½²**ï¼š
- ä½¿ç”¨Dockeréƒ¨ç½²ï¼ŒDockerfileå·²åŒ…å«å­—ä½“é…ç½®

**Dockeréƒ¨ç½²**ï¼š
- ä½¿ç”¨é¡¹ç›®æä¾›çš„Dockerfileï¼Œå·²åŒ…å«å­—ä½“å®‰è£…

**æœ¬åœ°å¼€å‘**ï¼š
- Windows: è‡ªåŠ¨ä½¿ç”¨å¾®è½¯é›…é»‘
- macOS: è‡ªåŠ¨ä½¿ç”¨PingFang
- Linux: æŒ‰æœ¬æŒ‡å—å®‰è£…å­—ä½“

---

æœ€åæ›´æ–°ï¼š2025-01-15


