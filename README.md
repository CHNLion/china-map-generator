# 中国地图生成器

中国地图生成器是一个基于Flask和GeoPandas的Web应用程序，用于从Shapefile文件生成中国行政区划地图。该应用程序提供了一个直观的用户界面，允许用户选择不同级别的行政区划（省、市、县），并自定义地图的样式和颜色。

## 功能特点

- **多级行政区划地图生成**：支持生成全国、省级、市级和县级地图
- **智能区域选择**：根据用户选择的最后一级行政区划自动确定绘制范围
- **区域突出显示**：可以在地图上突出显示特定区域，包括县级行政分界
- **自定义样式**：提供地图颜色、边界线宽度和颜色的自定义选项
- **地名标签控制**：可选择是否显示地区名称
- **经纬度坐标显示**：可选择是否显示经纬度网格和坐标，支持调整字体大小
- **地图标题控制**：可选择是否显示地图标题及自定义标题内容
- **直观的用户界面**：三级联动菜单，方便选择特定区域
- **图片下载**：生成的地图可以直接下载为PNG格式图片

## 行政分界说明

- **全国**：显示全国行政区划界限
- **省**：显示省级行政区划界限
- **市**：显示市级行政区划界限
- **县**：显示县级行政区划界限

无论选择哪种行政分界，系统将根据用户在底图区域中的最后一级选择来确定地图范围：

1. 如果选择了县级区域，则显示该县的地图
2. 如果只选择了市级区域，则显示该市的地图
3. 如果只选择了省级区域，则显示该省的地图
4. 如果没有选择任何区域，则显示全国地图

行政分界决定了地图上显示的行政边界级别，而不是地图的显示范围。

## 突出显示功能说明

启用突出显示功能后，可以在地图上突出显示特定区域。突出显示区域可以是省、市或县级行政区，且可以与底图区域不同。例如：

- 可以在全国地图上突出显示特定省份
- 可以在省级地图上突出显示特定城市
- 可以在市级地图上突出显示特定区县
- 可以在县级行政分界地图上突出显示特定区域

所有行政分界级别（包括县级）均支持突出显示功能。

## 经纬度坐标功能说明

应用支持在地图上显示经纬度坐标网格：

- 默认情况下，经纬度坐标功能是禁用的
- 启用"显示经纬度坐标"选项后，地图将显示经纬度网格和坐标值
- 可以调整经纬度坐标的字体大小（范围为10-30，默认值为20）
- 坐标以"度数°E/N"的格式显示（如"120.45°E"表示东经120.45度）
- 网格线以虚线形式显示，便于读取坐标位置
- 此功能特别适合需要定位具体地理位置的场景

## 地图标题功能说明

应用支持在地图顶部添加自定义标题：

- 默认情况下，标题功能是禁用的
- 启用"显示图片名称"选项后，可以添加标题
- 标题内容默认会根据所选区域自动生成：
  - 优先使用"突出显示区域"作为标题前缀（如果已启用突出显示）
  - 如果未启用突出显示，则使用底图区域作为标题前缀
  - 默认格式为"XX行政区划图"
- 可以自定义标题文本和字体大小

## 技术栈

- **后端**：
  - Python 3.9+
  - Flask (Web框架)
  - GeoPandas (地理数据处理)
  - Matplotlib (地图绘制)
  
- **前端**：
  - HTML5 / CSS3
  - JavaScript (原生)
  - Bootstrap 5 (UI框架)

## 安装指南

### 前提条件

- Python 3.9或更高版本
- pip包管理器
- Git (可选，用于克隆仓库)

### 安装步骤

1. 克隆仓库或下载源代码：

```bash
git clone <repository-url>
cd map_web
```

2. 创建并激活虚拟环境（推荐）：

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/macOS
python -m venv venv
source venv/bin/activate
```

3. 安装依赖项：

```bash
pip install -r requirements.txt
```

4. 确保您的Shapefile文件已准备好并放置在正确的位置：

```
map_web/
└── shp/
    ├── 省.shp
    ├── 市.shp
    ├── 县.shp
    └── ...
```

## 使用方法

1. 启动应用程序：

```bash
python app.py
```

2. 在浏览器中访问以下URL：

```
http://127.0.0.1:5000/
```

3. 使用Web界面生成地图：
   - 选择行政分界（全国、省、市或县）
   - 选择底图区域（省份、城市、县区）
   - 可选：启用突出显示并选择要突出显示的区域
   - 自定义地图颜色和样式
   - 点击"生成地图"按钮

4. 下载生成的地图：
   - 生成地图后，点击"下载地图图片"按钮保存PNG文件

## 示例用法

### 生成省级地图

1. 选择"省"行政分界
2. 从下拉菜单中选择一个省份（如"内蒙古自治区"）
3. 点击"生成地图"

### 生成带有经纬度坐标的地图

1. 选择所需的行政分界和区域
2. 启用"显示经纬度坐标"选项
3. 根据需要调整经纬度字体大小
4. 点击"生成地图"

### 生成全国地图并突出显示特定省份

1. 选择"全国"行政分界
2. 启用"突出显示"选项
3. 在突出显示区域中选择要突出显示的省份（如"广东省"）
4. 点击"生成地图"

### 生成市级地图并突出显示特定区县

1. 选择"市"行政分界
2. 在底图区域中选择省份和城市（如"广东省"和"深圳市"）
3. 启用"突出显示"选项
4. 在突出显示区域中，选择省份、城市和区县（如"广东省"、"深圳市"和"南山区"）
5. 点击"生成地图"

### 自定义地图样式

1. 调整底图颜色、突出显示颜色和边界线颜色
2. 调整边界线宽度（默认值为1.5）
3. 选择是否显示地区名称
4. 选择是否显示地图标题，可自定义标题内容和字体大小
5. 点击"生成地图"

## 项目结构

```
map_web/
├── app/
│   ├── controllers/
│   │   └── map_controller.py  # 地图生成逻辑
│   ├── static/
│   │   ├── css/
│   │   │   └── style.css
│   │   ├── js/
│   │   │   └── main.js       # 前端交互逻辑
│   │   └── maps/            # 生成的地图存储位置
│   └── templates/
│       └── index.html       # 主页面
├── shp/                     # Shapefile文件存储位置
│   ├── 省.shp
│   ├── 市.shp
│   ├── 县.shp
│   └── ...
├── app.py                   # Flask应用程序入口
└── requirements.txt         # 依赖项列表
```

## 注意事项

- 该应用程序依赖GeoPandas库，安装过程可能比较复杂。在Windows系统上，可能需要先安装GDAL和Fiona库
- 确保Shapefile文件的编码格式正确（通常为UTF-8或GBK）
- 应用程序默认使用突出显示颜色为RGB(126,210,247)
- 边界线宽度默认值为1.5，可在0.1-3.0之间调整
- 经纬度字体大小默认值为20，可在10-30之间调整
- 经纬度坐标以"度数°E/N"的格式显示，使用虚线网格辅助定位

## 许可证

本项目采用MIT许可证。详情请参阅LICENSE文件。 
