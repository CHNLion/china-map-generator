<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中国地图生成器</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="48x48" href="{{ url_for('static', filename='favicon-48x48.png') }}">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#0ba6a9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="地图生成器">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <!-- Pickr 颜色选择器 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-10 offset-md-1">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h2 class="text-center">中国地图生成器</h2>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h5 class="mb-0">
                                <button class="btn btn-link text-decoration-none p-0 text-start w-100 d-flex justify-content-between align-items-center" 
                                        type="button" 
                                        data-bs-toggle="collapse" 
                                        data-bs-target="#usageInstructions" 
                                        aria-expanded="false" 
                                        aria-controls="usageInstructions"
                                        style="color: #055160; font-weight: 600;">
                                    使用说明
                                    <span class="toggle-icon">▼</span>
                                </button>
                            </h5>
                            <div class="collapse" id="usageInstructions">
                                <ul class="mt-3 mb-0">
                                    <li><strong>行政分界选择：</strong>选择地图显示的行政边界级别（全国、省、市或县级边界）</li>
                                    <li><strong>底图区域：</strong>选择要显示的具体区域，系统将根据您最后选择的级别确定显示范围</li>
                                    <li><strong>多区域突出显示：</strong>
                                        <ul class="mt-1 mb-1">
                                            <li>可同时突出显示多个区域，每个区域可设置不同颜色</li>
                                            <li>突出显示区域会自动跟随底图区域（智能锁定）</li>
                                            <li>点击"+ 添加区域"可添加更多突出区域，点击"删除"移除不需要的区域</li>
                                        </ul>
                                    </li>
                                    <li><strong>高级颜色选择：</strong>
                                        <ul class="mt-1 mb-1">
                                            <li>使用 Pickr 专业颜色选择器，支持渐变色板、色相滑块和预设颜色</li>
                                            <li>拖动选色圈选择颜色，释放鼠标后自动应用并关闭</li>
                                            <li>点击预设色块可快速选择常用颜色</li>
                                            <li><strong>吸管取色工具：</strong>点击调色板中的吸管图标，可从屏幕任意位置取色（需Chrome/Edge浏览器支持）</li>
                                        </ul>
                                    </li>
                                    <li><strong>显示地区名称：</strong>控制是否在地图上显示地区名称标签</li>
                                    <li><strong>显示图片名称：</strong>控制是否在地图顶部显示标题，可自定义标题内容和字体大小</li>
                                    <li><strong>显示经纬度坐标：</strong>控制是否在地图上显示经纬度网格和坐标，可调整字体大小（10-30）</li>
                                    <li><strong>显示比例尺：</strong>
                                        <ul class="mt-1 mb-1">
                                            <li>三种专业样式：分段式（黑白交替）、刻度线式、双行交替式</li>
                                            <li>比例尺自动根据地图大小计算，确保比例准确</li>
                                            <li>可自定义位置（四个角落）和字体大小</li>
                                        </ul>
                                    </li>
                                    <li><strong>地图投影：</strong>使用Lambert正形圆锥投影（中国测绘标准），确保地图比例准确</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <h4>选择行政分界</h4>
                                <div class="form-group">
                                    <div class="btn-group" role="group" aria-label="地图类型选择">
                                        <input type="radio" class="btn-check" name="mapTypeRadio" id="mapTypeNational" value="national" checked>
                                        <label class="btn btn-outline-primary" for="mapTypeNational">全国</label>
                                        
                                        <input type="radio" class="btn-check" name="mapTypeRadio" id="mapTypeProvince" value="省">
                                        <label class="btn btn-outline-primary" for="mapTypeProvince">省</label>
                                        
                                        <input type="radio" class="btn-check" name="mapTypeRadio" id="mapTypeCity" value="市">
                                        <label class="btn btn-outline-primary" for="mapTypeCity">市</label>
                                        
                                        <input type="radio" class="btn-check" name="mapTypeRadio" id="mapTypeCounty" value="县">
                                        <label class="btn btn-outline-primary" for="mapTypeCounty">县</label>
                                    </div>
                                    <input type="hidden" id="mapType" value="省">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 底图区域选择 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <h4 class="mb-3">底图区域</h4>
                            </div>
                            <!-- 省级选择 -->
                            <div class="col-md-4" id="provinceSelectContainer">
                                <h5>选择省份</h5>
                                <select id="provinceSelect" class="form-select">
                                    <option value="">请选择省份</option>
                                    <!-- 省份选项将通过JavaScript动态加载 -->
                                </select>
                            </div>
                            <!-- 市级选择 -->
                            <div class="col-md-4" id="citySelectContainer" style="display: none;">
                                <h5>选择城市</h5>
                                <select id="citySelect" class="form-select">
                                    <option value="">请先选择省份</option>
                                    <!-- 城市选项将通过JavaScript动态加载 -->
                                </select>
                            </div>
                            <!-- 县级选择 -->
                            <div class="col-md-4" id="countySelectContainer" style="display: none;">
                                <h5>选择县区</h5>
                                <select id="countySelect" class="form-select">
                                    <option value="">请先选择城市</option>
                                    <!-- 县区选项将通过JavaScript动态加载 -->
                                </select>
                            </div>
                        </div>
                        
                        <!-- 突出区域设置 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="enableHighlight">
                                            <label class="form-check-label" for="enableHighlight">启用突出显示</label>
                                        </div>
                                    </div>
                                    <div class="card-body" id="highlightOptions" style="display: none;">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h4 class="mb-0">突出显示区域</h4>
                                            <button type="button" class="btn btn-sm btn-primary" id="addHighlightRegion">
                                                <span>+ 添加区域</span>
                                            </button>
                                        </div>
                                        <div id="highlightRegionsContainer">
                                            <!-- 突出显示区域将通过JavaScript动态添加 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 颜色设置 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">自定义颜色</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="baseColor" class="form-label">底图颜色</label>
                                                    <input type="color" class="form-control form-control-color" id="baseColor" value="#EAEAEA" title="选择底图颜色">
                                                </div>
                                            </div>
                                            <!-- 突出显示颜色已移至各个高亮区域中单独设置 -->
                                            <div class="col-md-4" style="display: none;">
                                                <div class="mb-3">
                                                    <label for="highlightColor" class="form-label">突出显示颜色</label>
                                                    <input type="color" class="form-control form-control-color" id="highlightColor" value="#7ED2F7" title="选择突出显示颜色">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="borderColor" class="form-label">边界线颜色</label>
                                                    <input type="color" class="form-control form-control-color" id="borderColor" value="#FFFFFF" title="选择边界线颜色">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="borderWidth" class="form-label">边界线宽度</label>
                                                    <div class="d-flex align-items-center">
                                                        <input type="range" class="form-range me-2" min="0.1" max="3.0" step="0.1" id="borderWidth" value="1.5" list="borderWidthTicks">
                                                        <datalist id="borderWidthTicks">
                                                            <option value="0.1"></option>
                                                            <option value="0.5"></option>
                                                            <option value="1.0"></option>
                                                            <option value="1.5"></option>
                                                            <option value="2.0"></option>
                                                            <option value="2.5"></option>
                                                            <option value="3.0"></option>
                                                        </datalist>
                                                        <input type="number" class="form-control" id="borderWidthInput" value="1.5" min="0.1" max="3.0" step="0.1" style="width: 80px;">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 显示标签选项 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="showLabels">
                                    <label class="form-check-label" for="showLabels">
                                        显示地区名称
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 显示图片名称选项 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="enableCustomTitle">
                                    <label class="form-check-label" for="enableCustomTitle">
                                        显示图片名称
                                    </label>
                                </div>
                                <div id="titleOptions" class="mt-2" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group mb-2">
                                                <label for="customTitle" class="form-label">标题内容</label>
                                                <input type="text" class="form-control" id="customTitle" placeholder="输入地图标题">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mb-2">
                                                <label for="titleFontSize" class="form-label">字体大小</label>
                                                <select class="form-select" id="titleFontSize">
                                                    <option value="12">12 像素</option>
                                                    <option value="14">14 像素</option>
                                                    <option value="15" selected>15 像素</option>
                                                    <option value="16">16 像素</option>
                                                    <option value="18">18 像素</option>
                                                    <option value="20">20 像素</option>
                                                    <option value="24">24 像素</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 显示经纬度选项 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="showCoordinates">
                                    <label class="form-check-label" for="showCoordinates">
                                        显示经纬度坐标
                                    </label>
                                </div>
                                <div class="row mt-2" id="coordinatesFontSizeContainer" style="display: none;">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="coordinatesFontSize" class="form-label">字体大小</label>
                                            <div class="d-flex align-items-center">
                                                <input type="range" class="form-range me-2" min="10" max="30" step="1" id="coordinatesFontSize" value="20" list="coordinatesFontSizeTicks">
                                                <datalist id="coordinatesFontSizeTicks">
                                                    <option value="10"></option>
                                                    <option value="15"></option>
                                                    <option value="20"></option>
                                                    <option value="25"></option>
                                                    <option value="30"></option>
                                                </datalist>
                                                <input type="number" class="form-control" id="coordinatesFontSizeInput" value="20" min="10" max="30" step="1" style="width: 80px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 显示比例尺选项 -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="showScaleBar">
                                    <label class="form-check-label" for="showScaleBar">
                                        显示比例尺
                                    </label>
                                </div>
                                <div id="scaleBarOptions" class="mt-2" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group mb-2">
                                                <label for="scaleBarStyle" class="form-label">比例尺样式</label>
                                                <select class="form-select" id="scaleBarStyle">
                                                    <option value="segmented" selected>分段式（黑白交替）</option>
                                                    <option value="tick_only">刻度线式</option>
                                                    <option value="double_row">双行交替式</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mb-2">
                                                <label for="scaleBarLocation" class="form-label">比例尺位置</label>
                                                <select class="form-select" id="scaleBarLocation">
                                                    <option value="lower right" selected>右下角</option>
                                                    <option value="lower left">左下角</option>
                                                    <option value="upper right">右上角</option>
                                                    <option value="upper left">左上角</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mb-2">
                                                <label for="scaleBarFontSize" class="form-label">字体大小</label>
                                                <select class="form-select" id="scaleBarFontSize">
                                                    <option value="8">8 像素</option>
                                                    <option value="10">10 像素</option>
                                                    <option value="12" selected>12 像素</option>
                                                    <option value="14">14 像素</option>
                                                    <option value="16">16 像素</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mb-4">
                            <button id="generateBtn" class="btn btn-primary btn-lg">生成地图</button>
                        </div>
                        
                        <div id="loadingIndicator" class="text-center d-none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                            <p>正在生成地图，请稍候...</p>
                        </div>
                        
                        <div id="mapResult" class="d-none">
                            <h4 class="text-center mb-3">生成的地图</h4>
                            <div class="text-center">
                                <img id="mapImage" class="img-fluid border" alt="生成的地图">
                            </div>
                            <div class="mt-3 text-center">
                                <a id="downloadLink" class="btn btn-success" download>下载地图图片</a>
                            </div>
                        </div>
                        
                        <div id="errorMessage" class="alert alert-danger mt-3 d-none">
                            <strong>错误：</strong> <span id="errorText"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="mt-5 mb-4 text-center text-muted">
        <p class="mb-2">中国地图生成器 by CHNLion © 2025</p>
        <p class="mb-0">
            <a href="https://github.com/CHNLion/china-map-generator" target="_blank" class="text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-github me-1" viewBox="0 0 16 16" style="vertical-align: text-bottom;">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                在 GitHub 上查看此项目
            </a>
        </p>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Pickr 颜色选择器 -->
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/multi-highlight.js') }}"></script>
    <script src="{{ url_for('static', filename='js/color-picker.js') }}"></script>
</body>
</html> 